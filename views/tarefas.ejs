<!-- NavegaÃ§Ã£o -->
<div class="card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%); border: 1px solid rgba(59, 130, 246, 0.2); margin-bottom: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
        <div>
            <h2 style="margin: 0; color: #2563eb;">ğŸ“‹ Gerenciador de Tarefas</h2>
            <p style="margin: 5px 0 0; color: var(--text-secondary);"><%= description %></p>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="/projetos" class="btn" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); text-decoration: none; color: white; display: flex; align-items: center; gap: 8px;">
                ğŸ“ Ver Projetos
            </a>
            <a href="/" class="btn" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); text-decoration: none; color: white;">
                ğŸ  Dashboard
            </a>
        </div>
    </div>
</div>

<!-- Dashboard de EstatÃ­sticas -->
<div class="card">
    <h3>ï¿½ Dashboard de Tarefas</h3>
    <div id="estatisticas-dashboard" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%); border-radius: 15px; border: 1px solid rgba(34, 197, 94, 0.2);">
            <div style="font-size: 2rem; margin-bottom: 10px; color: #22c55e;">âœ…</div>
            <div id="total-concluidas" style="font-size: 1.5rem; font-weight: 600; color: #22c55e; margin-bottom: 5px;">-</div>
            <div style="font-size: 0.9rem; color: var(--text-light);">ConcluÃ­das</div>
        </div>
        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%); border-radius: 15px; border: 1px solid rgba(245, 158, 11, 0.2);">
            <div style="font-size: 2rem; margin-bottom: 10px; color: #f59e0b;">â³</div>
            <div id="total-pendentes" style="font-size: 1.5rem; font-weight: 600; color: #f59e0b; margin-bottom: 5px;">-</div>
            <div style="font-size: 0.9rem; color: var(--text-light);">Pendentes</div>
        </div>
        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%); border-radius: 15px; border: 1px solid rgba(59, 130, 246, 0.2);">
            <div style="font-size: 2rem; margin-bottom: 10px; color: #3b82f6;">ğŸ“ˆ</div>
            <div id="porcentagem-conclusao" style="font-size: 1.5rem; font-weight: 600; color: #3b82f6; margin-bottom: 5px;">-</div>
            <div style="font-size: 0.9rem; color: var(--text-light);">% Completo</div>
        </div>
        <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(168, 85, 247, 0.05) 100%); border-radius: 15px; border: 1px solid rgba(168, 85, 247, 0.2);">
            <div style="font-size: 2rem; margin-bottom: 10px; color: #a855f7;">ğŸ“‹</div>
            <div id="total-tarefas" style="font-size: 1.5rem; font-weight: 600; color: #a855f7; margin-bottom: 5px;">-</div>
            <div style="font-size: 0.9rem; color: var(--text-light);">Total</div>
        </div>
    </div>
</div>

<div class="card">
    <h3>ğŸ“ Lista de Tarefas</h3>
    <!-- Controles de AÃ§Ã£o -->
    <div class="task-controls" style="margin: 20px 0; display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
        <button onclick="carregarTarefas()" class="btn">ğŸ”„ Atualizar Lista</button>
        <a href="/" class="btn" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); text-decoration: none; color: white; display: flex; align-items: center; gap: 5px;">
            ğŸ  Criar Nova Tarefa
        </a>
        <button onclick="popularBanco()" class="btn" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">ğŸŒ± Popular Banco</button>
        <button onclick="limparBanco()" class="btn" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">ğŸ—‘ï¸ Limpar Banco</button>
    </div>

    <!-- Filtros e OrdenaÃ§Ã£o por Prioridade -->
    <div style="margin: 20px 0; padding: 20px; background: var(--card-bg); border-radius: 15px; border: 1px solid var(--card-border);">
        <h4 style="margin: 0 0 15px 0; color: var(--text-primary);">ğŸ¯ Filtros e OrdenaÃ§Ã£o</h4>
        
        <div class="filter-controls" style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">
            <!-- Filtro por Prioridade -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-weight: 500; color: var(--text-primary);">Prioridade:</label>
                <select id="filtro-prioridade" onchange="aplicarFiltros()" style="padding: 8px 12px; border: 1px solid var(--card-border); border-radius: 8px; background: var(--card-bg); color: var(--text-primary);">
                    <option value="">ğŸ¯ Todas</option>
                    <option value="urgente">ğŸ”¥ Urgente</option>
                    <option value="alta">ğŸ”´ Alta</option>
                    <option value="media">ğŸŸ¡ MÃ©dia</option>
                    <option value="baixa">ğŸŸ¢ Baixa</option>
                </select>
            </div>

            <!-- Filtro por Projeto -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-weight: 500; color: var(--text-primary);">Projeto:</label>
                <select id="filtro-projeto" onchange="aplicarFiltros()" style="padding: 8px 12px; border: 1px solid var(--card-border); border-radius: 8px; background: var(--card-bg); color: var(--text-primary);">
                    <option value="">ğŸ“ Todos os projetos</option>
                    <!-- Projetos serÃ£o carregados dinamicamente -->
                </select>
            </div>

            <!-- Filtro por Status -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-weight: 500; color: var(--text-primary);">Status:</label>
                <select id="filtro-status" onchange="aplicarFiltros()" style="padding: 8px 12px; border: 1px solid var(--card-border); border-radius: 8px; background: var(--card-bg); color: var(--text-primary);">
                    <option value="">ğŸ“‹ Todas</option>
                    <option value="pendente">â³ Pendentes</option>
                    <option value="concluida">âœ… ConcluÃ­das</option>
                </select>
            </div>

            <!-- OrdenaÃ§Ã£o -->
            <div style="display: flex; align-items: center; gap: 8px;">
                <label style="font-weight: 500; color: var(--text-primary);">Ordenar por:</label>
                <select id="ordenacao" onchange="aplicarFiltros()" style="padding: 8px 12px; border: 1px solid var(--card-border); border-radius: 8px; background: var(--card-bg); color: var(--text-primary);">
                    <option value="prioridade">ğŸ¯ Prioridade</option>
                    <option value="titulo">ğŸ“ TÃ­tulo</option>
                    <option value="data">ğŸ“… Data</option>
                    <option value="status">âœ… Status</option>
                </select>
            </div>

            <!-- Limpar Filtros -->
            <button onclick="limparFiltros()" class="btn" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); font-size: 0.9rem; padding: 8px 16px;">ğŸ—‘ï¸ Limpar</button>
        </div>
    </div>
    <div id="lista-tarefas" style="margin-top: 20px;">
        <div style="text-align: center; padding: 40px; color: var(--text-light);">
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>Carregando tarefas...</p>
        </div>
    </div>
</div>





<div class="card">
    <h3>ğŸ“Š EstatÃ­sticas das Tarefas</h3>
    <div id="estatisticas-tarefas" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px;">
        <div style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); padding: 20px; border-radius: 12px; text-align: center; color: white; box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);">
            <h4 id="stat-concluidas" style="margin: 0; font-size: 2rem; font-weight: bold;">0</h4>
            <p style="margin: 8px 0 0 0; opacity: 0.9; font-size: 0.9rem;">âœ… ConcluÃ­das</p>
        </div>
        <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 20px; border-radius: 12px; text-align: center; color: white; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);">
            <h4 id="stat-pendentes" style="margin: 0; font-size: 2rem; font-weight: bold;">0</h4>
            <p style="margin: 8px 0 0 0; opacity: 0.9; font-size: 0.9rem;">â³ Pendentes</p>
        </div>
        <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 20px; border-radius: 12px; text-align: center; color: white; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);">
            <h4 id="stat-total" style="margin: 0; font-size: 2rem; font-weight: bold;">0</h4>
            <p style="margin: 8px 0 0 0; opacity: 0.9; font-size: 0.9rem;">ğŸ“‹ Total</p>
        </div>
        <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); padding: 20px; border-radius: 12px; text-align: center; color: white; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);">
            <h4 id="stat-progresso" style="margin: 0; font-size: 2rem; font-weight: bold;">0%</h4>
            <p style="margin: 8px 0 0 0; opacity: 0.9; font-size: 0.9rem;">ğŸ“Š Progresso</p>
        </div>
    </div>
    
    <!-- EstatÃ­sticas por Prioridade -->
    <div style="margin-top: 25px;">
        <h4 style="margin: 0 0 15px 0; color: var(--text-primary); font-size: 1.1rem;">ğŸ¯ Por Prioridade</h4>
        <div id="stats-prioridade" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
            <div style="background: #fef2f2; border: 1px solid #fecaca; padding: 12px; border-radius: 8px; text-align: center;">
                <div id="stat-urgente" style="font-weight: bold; color: #dc2626; font-size: 1.5rem;">0</div>
                <div style="color: #dc2626; font-size: 0.8rem; margin-top: 4px;">ğŸ”¥ Urgente</div>
            </div>
            <div style="background: #fef3c7; border: 1px solid #fde68a; padding: 12px; border-radius: 8px; text-align: center;">
                <div id="stat-alta" style="font-weight: bold; color: #d97706; font-size: 1.5rem;">0</div>
                <div style="color: #d97706; font-size: 0.8rem; margin-top: 4px;">ğŸ”´ Alta</div>
            </div>
            <div style="background: #fef9c3; border: 1px solid #fde047; padding: 12px; border-radius: 8px; text-align: center;">
                <div id="stat-media" style="font-weight: bold; color: #ca8a04; font-size: 1.5rem;">0</div>
                <div style="color: #ca8a04; font-size: 0.8rem; margin-top: 4px;">ğŸŸ¡ MÃ©dia</div>
            </div>
            <div style="background: #f0fdf4; border: 1px solid #bbf7d0; padding: 12px; border-radius: 8px; text-align: center;">
                <div id="stat-baixa" style="font-weight: bold; color: #16a34a; font-size: 1.5rem;">0</div>
                <div style="color: #16a34a; font-size: 0.8rem; margin-top: 4px;">ğŸŸ¢ Baixa</div>
            </div>
        </div>
    </div>
</div>

<script>
// Event listener serÃ¡ definido mais abaixo junto com o formulÃ¡rio

// FunÃ§Ã£o para carregar projetos
function carregarProjetos() {
    console.log('ğŸ“ Carregando projetos...');
    
    fetch('/api/projetos')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                todosProjetos = data.data;
                console.log('ğŸ“ Projetos carregados:', todosProjetos.length);
                
                // Atualizar select de projetos no formulÃ¡rio
                const selectProjeto = document.getElementById('input-projeto');
                selectProjeto.innerHTML = '<option value="">ğŸ“‹ Sem projeto especÃ­fico</option>';
                
                // Atualizar filtro de projetos
                const filtroProjeto = document.getElementById('filtro-projeto');
                if (filtroProjeto) {
                    filtroProjeto.innerHTML = '<option value="">ğŸ“ Todos os projetos</option>';
                }
                
                todosProjetos.forEach(projeto => {
                    // Adicionar ao select do formulÃ¡rio
                    const option1 = document.createElement('option');
                    option1.value = projeto._id;
                    option1.textContent = `ğŸ“ ${projeto.nome}`;
                    selectProjeto.appendChild(option1);
                    
                    // Adicionar ao filtro
                    if (filtroProjeto) {
                        const option2 = document.createElement('option');
                        option2.value = projeto._id;
                        option2.textContent = `ğŸ“ ${projeto.nome}`;
                        filtroProjeto.appendChild(option2);
                    }
                });
            }
        })
        .catch(error => {
            console.error('âŒ Erro ao carregar projetos:', error);
        });
}

function atualizarEstatisticas(tarefas) {
    console.log('ğŸ“Š Atualizando estatÃ­sticas...', tarefas);
    
    if (!tarefas || !Array.isArray(tarefas)) {
        console.warn('âš ï¸ Dados de tarefas invÃ¡lidos');
        return;
    }
    
    // Calcular estatÃ­sticas bÃ¡sicas
    const total = tarefas.length;
    const concluidas = tarefas.filter(t => t.concluida).length;
    const pendentes = total - concluidas;
    const progresso = total > 0 ? Math.round((concluidas / total) * 100) : 0;
    
    // Calcular por prioridade (apenas pendentes)
    const tarefasPendentes = tarefas.filter(t => !t.concluida);
    const porPrioridade = {
        urgente: tarefasPendentes.filter(t => t.prioridade === 'urgente').length,
        alta: tarefasPendentes.filter(t => t.prioridade === 'alta').length,
        media: tarefasPendentes.filter(t => t.prioridade === 'media').length,
        baixa: tarefasPendentes.filter(t => t.prioridade === 'baixa').length
    };
    
    // Atualizar elementos da interface
    document.getElementById('stat-concluidas').textContent = concluidas;
    document.getElementById('stat-pendentes').textContent = pendentes;
    document.getElementById('stat-total').textContent = total;
    document.getElementById('stat-progresso').textContent = progresso + '%';
    
    // Atualizar estatÃ­sticas por prioridade
    document.getElementById('stat-urgente').textContent = porPrioridade.urgente;
    document.getElementById('stat-alta').textContent = porPrioridade.alta;
    document.getElementById('stat-media').textContent = porPrioridade.media;
    document.getElementById('stat-baixa').textContent = porPrioridade.baixa;
    
    console.log('ğŸ“ˆ EstatÃ­sticas atualizadas:', {
        total, concluidas, pendentes, progresso, porPrioridade
    });
}

function carregarTarefas() {
    console.log('ğŸ”„ Carregando tarefas...');
    
    // Mostrar loading
    document.getElementById('lista-tarefas').innerHTML = `
        <div style="text-align: center; padding: 40px; color: var(--text-light);">
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
            <p>Carregando tarefas...</p>
        </div>
    `;
    
    fetch('/api/tarefas')
        .then(response => {
            console.log('ğŸ“¡ Response status:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('ğŸ“‹ Dados recebidos:', data);
            
            if (data.success) {
                // Armazenar tarefas globalmente para filtros
                todasAsTarefas = data.data;
                console.log('ğŸ’¾ Tarefas armazenadas:', todasAsTarefas.length, 'tarefas');
                
                // Atualizar estatÃ­sticas na interface
                atualizarEstatisticas(todasAsTarefas);
                
                // Aplicar filtros atuais
                aplicarFiltros();
            } else {
                console.error('âŒ Erro na API:', data.erro);
                mostrarErro(data.erro || 'Erro ao carregar tarefas');
            }
        })
        .catch(error => {
            console.error('âŒ Erro:', error);
            mostrarErro('Erro de conexÃ£o com a API');
        });
}



function mostrarErro(mensagem) {
    document.getElementById('lista-tarefas').innerHTML = `
        <div style="text-align: center; padding: 40px; color: #ef4444;">
            <div style="font-size: 3rem; margin-bottom: 20px;">âŒ</div>
            <h4>Ops! Algo deu errado</h4>
            <p>${mensagem}</p>
            <button onclick="carregarTarefas()" class="btn" style="margin-top: 15px;">ğŸ”„ Tentar Novamente</button>
        </div>
    `;
}



// InicializaÃ§Ã£o da pÃ¡gina
document.addEventListener('DOMContentLoaded', function() {
    carregarProjetos();
    carregarTarefas();
});



function concluirTarefa(id) {
    console.log('âœ… Concluindo tarefa:', id);
    
    fetch(`/api/tarefas/${id}/concluir`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log('âœ… Resposta:', data);
        
        if (data.success) {
            alert(`âœ… ${data.message}`);
            carregarTarefas(); // Recarregar lista
        } else {
            alert(`âŒ Erro: ${data.erro}`);
        }
    })
    .catch(error => {
        console.error('âŒ Erro:', error);
        alert('âŒ Erro de conexÃ£o com o servidor');
    });
}

function editarTarefa(id) {
    console.log('âœï¸ Editando tarefa:', id);
    
    // Redirecionar para o sistema centralizado com parÃ¢metro de ediÃ§Ã£o
    window.location.href = `/?edit=tarefa&id=${id}`;
}



function deletarTarefa(id) {
    if (!confirm('Tem certeza que deseja deletar esta tarefa?')) return;
    
    console.log('ğŸ—‘ï¸ Deletando tarefa:', id);
    
    fetch(`/api/tarefas/${id}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log('ğŸ—‘ï¸ Resposta:', data);
        
        if (data.success) {
            alert(`ğŸ—‘ï¸ ${data.message}`);
            carregarTarefas(); // Recarregar lista
        } else {
            alert(`âŒ Erro: ${data.erro}`);
        }
    })
    .catch(error => {
        console.error('âŒ Erro:', error);
        alert('âŒ Erro de conexÃ£o com o servidor');
    });
}

function popularBanco() {
    if (!confirm('Deseja popular o banco de dados com tarefas de exemplo?\n\nIsso sÃ³ funcionarÃ¡ se o banco estiver vazio.')) return;
    
    console.log('ğŸŒ± Populando banco de dados...');
    
    fetch('/api/popular-banco', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log('ğŸŒ± Resposta:', data);
        
        if (data.success) {
            alert(`ğŸŒ± ${data.message}\n\nTarefas inseridas: ${data.tarefas_inseridas}`);
            carregarTarefas(); // Recarregar lista
        } else {
            alert(`âš ï¸ ${data.message || data.erro}`);
        }
    })
    .catch(error => {
        console.error('âŒ Erro:', error);
        alert('âŒ Erro de conexÃ£o com o servidor');
    });
}

function limparBanco() {
    if (!confirm('âš ï¸ ATENÃ‡ÃƒO: Esta aÃ§Ã£o irÃ¡ remover TODAS as tarefas do banco de dados!\n\nTem certeza que deseja continuar?')) return;
    
    const confirmacao = prompt('Digite "CONFIRMAR" para prosseguir:');
    if (confirmacao !== 'CONFIRMAR') {
        alert('âŒ OperaÃ§Ã£o cancelada');
        return;
    }
    
    console.log('ğŸ—‘ï¸ Limpando banco de dados...');
    
    fetch('/api/limpar-banco', {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log('ğŸ—‘ï¸ Resposta:', data);
        
        if (data.success) {
            alert(`ğŸ—‘ï¸ ${data.message}\n\nTarefas removidas: ${data.tarefas_removidas}`);
            carregarTarefas(); // Recarregar lista
        } else {
            alert(`âŒ Erro: ${data.erro}`);
        }
    })
    .catch(error => {
        console.error('âŒ Erro:', error);
        alert('âŒ Erro de conexÃ£o com o servidor');
    });
}

// VariÃ¡veis globais para armazenar dados
let todasAsTarefas = [];
let todosProjetos = [];

// FunÃ§Ã£o para aplicar filtros e ordenaÃ§Ã£o
function aplicarFiltros() {
    console.log('ğŸ¯ Aplicando filtros...');
    const filtroProjeto = document.getElementById('filtro-projeto').value;
    const filtroPrioridade = document.getElementById('filtro-prioridade').value;
    const filtroStatus = document.getElementById('filtro-status').value;
    const ordenacao = document.getElementById('ordenacao').value;
    console.log('ğŸ” Filtros:', { filtroProjeto, filtroPrioridade, filtroStatus, ordenacao });
    
    let tarefasFiltradas = [...todasAsTarefas];
    
    // Aplicar filtro de projeto
    if (filtroProjeto) {
        tarefasFiltradas = tarefasFiltradas.filter(tarefa => tarefa.projeto === filtroProjeto);
    }
    
    // Aplicar filtro de prioridade
    if (filtroPrioridade) {
        tarefasFiltradas = tarefasFiltradas.filter(tarefa => tarefa.prioridade === filtroPrioridade);
    }
    
    // Aplicar filtro de status
    if (filtroStatus) {
        if (filtroStatus === 'pendente') {
            tarefasFiltradas = tarefasFiltradas.filter(tarefa => !tarefa.concluida);
        } else if (filtroStatus === 'concluida') {
            tarefasFiltradas = tarefasFiltradas.filter(tarefa => tarefa.concluida);
        }
    }
    
    // Aplicar ordenaÃ§Ã£o
    tarefasFiltradas.sort((a, b) => {
        switch (ordenacao) {
            case 'prioridade':
                const prioridadeOrdem = { 'urgente': 4, 'alta': 3, 'media': 2, 'baixa': 1 };
                return (prioridadeOrdem[b.prioridade] || 0) - (prioridadeOrdem[a.prioridade] || 0);
            
            case 'titulo':
                return a.titulo.localeCompare(b.titulo);
            
            case 'data':
                return new Date(b.criadaEm) - new Date(a.criadaEm);
            
            case 'status':
                return a.concluida === b.concluida ? 0 : (a.concluida ? 1 : -1);
            
            default:
                return 0;
        }
    });
    
    renderizarTarefas(tarefasFiltradas);
    
    // Atualizar estatÃ­sticas com base nas tarefas filtradas
    atualizarEstatisticas(tarefasFiltradas);
}

// FunÃ§Ã£o para limpar todos os filtros
function limparFiltros() {
    document.getElementById('filtro-projeto').value = '';
    document.getElementById('filtro-prioridade').value = '';
    document.getElementById('filtro-status').value = '';
    document.getElementById('ordenacao').value = 'prioridade';
    aplicarFiltros();
}

// FunÃ§Ã£o para renderizar tarefas (extraÃ­da da funÃ§Ã£o carregarTarefas)
function renderizarTarefas(tarefas) {
    console.log('ğŸ–¼ï¸ Renderizando', tarefas.length, 'tarefas');
    const listaTarefas = document.getElementById('lista-tarefas');
    
    if (tarefas.length === 0) {
        listaTarefas.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-light);">ğŸ“­ Nenhuma tarefa encontrada com os filtros aplicados</div>';
        return;
    }
    
    let html = '';
    
    tarefas.forEach(tarefa => {
        const prioridadeConfig = {
            'urgente': { cor: '#dc2626', icone: 'ğŸ”¥', texto: 'URGENTE' },
            'alta': { cor: '#ef4444', icone: 'ğŸ”´', texto: 'ALTA' },
            'media': { cor: '#f59e0b', icone: 'ğŸŸ¡', texto: 'MÃ‰DIA' },
            'baixa': { cor: '#22c55e', icone: 'ğŸŸ¢', texto: 'BAIXA' }
        };
        
        const statusIcon = tarefa.concluida ? 'âœ…' : 'â³';
        const statusColor = tarefa.concluida ? '#22c55e' : '#f59e0b';
        
        html += `
            <div style="background: var(--card-bg); padding: 20px; border-radius: 15px; margin: 15px 0; border: 1px solid var(--card-border); box-shadow: var(--shadow-light);">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; margin-bottom: 8px; flex-wrap: wrap; gap: 8px;">
                            <span style="font-size: 1.2rem;">${statusIcon}</span>
                            <h4 style="margin: 0; color: var(--text-primary); flex: 1; min-width: 200px;">${tarefa.titulo}</h4>
                            <span style="background: ${prioridadeConfig[tarefa.prioridade]?.cor || '#6b7280'}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <span>${prioridadeConfig[tarefa.prioridade]?.icone || 'âšª'}</span>
                                ${prioridadeConfig[tarefa.prioridade]?.texto || tarefa.prioridade.toUpperCase()}
                            </span>
                        </div>
                        <p style="margin: 8px 0; color: var(--text-light); line-height: 1.5;">${tarefa.descricao}</p>
                        
                        <div style="display: flex; gap: 15px; margin-top: 12px; flex-wrap: wrap; font-size: 0.85rem;">
                            <span style="color: var(--text-light);">
                                ğŸ“… Criada: ${new Date(tarefa.criadaEm).toLocaleDateString('pt-BR')}
                            </span>
                            
                            ${tarefa.dataVencimento ? `
                                <span style="color: ${new Date(tarefa.dataVencimento) < new Date() ? '#ef4444' : '#f59e0b'};">
                                    ğŸ—“ï¸ Vence: ${new Date(tarefa.dataVencimento).toLocaleDateString('pt-BR')}
                                    ${new Date(tarefa.dataVencimento) < new Date() ? 'âš ï¸' : ''}
                                </span>
                            ` : ''}
                            
                            ${tarefa.projeto ? `
                                <span style="background: rgba(34, 197, 94, 0.1); color: #16a34a; padding: 2px 8px; border-radius: 8px;">
                                    ğŸ“ ${obterNomeProjeto(tarefa.projeto)}
                                </span>
                            ` : ''}
                            
                            ${tarefa.categoria ? `
                                <span style="background: rgba(99, 102, 241, 0.1); color: #6366f1; padding: 2px 8px; border-radius: 8px;">
                                    ğŸ·ï¸ ${tarefa.categoria}
                                </span>
                            ` : ''}
                            
                            ${tarefa.tempoEstimado ? `
                                <span style="background: rgba(34, 197, 94, 0.1); color: #22c55e; padding: 2px 8px; border-radius: 8px;">
                                    â±ï¸ ${tarefa.tempoEstimado}
                                </span>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 8px; margin-left: 15px; flex-wrap: wrap;">
                        ${!tarefa.concluida ? `
                            <button onclick="concluirTarefa('${tarefa._id}')" class="btn" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); font-size: 0.8rem; padding: 6px 12px;">
                                âœ… Concluir
                            </button>
                        ` : ''}
                        
                        <button onclick="editarTarefa('${tarefa._id}')" class="btn" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); font-size: 0.8rem; padding: 6px 12px;">
                            âœï¸ Editar
                        </button>
                        
                        <button onclick="removerTarefa('${tarefa._id}')" class="btn" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); font-size: 0.8rem; padding: 6px 12px;">
                            ğŸ—‘ï¸ Remover
                        </button>
                    </div>
                </div>
                
                ${tarefa.concluida ? `
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 12px; border-radius: 10px; border-left: 4px solid #22c55e;">
                        <span style="color: #22c55e; font-size: 0.9rem;">
                            âœ… Tarefa concluÃ­da em ${new Date(tarefa.atualizadaEm).toLocaleDateString('pt-BR')}
                        </span>
                    </div>
                ` : ''}
            </div>
        `;
    });
    
    listaTarefas.innerHTML = html;
}

// FunÃ§Ã£o auxiliar para obter nome do projeto
function obterNomeProjeto(projetoId) {
    const projeto = todosProjetos.find(p => p._id === projetoId);
    return projeto ? projeto.nome : 'Projeto nÃ£o encontrado';
}
</script>


