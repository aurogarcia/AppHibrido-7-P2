<%- include('layout', { titulo: titulo }) %>

<section class="container">
    <div class="header-section">
        <h1>üìÅ <%= titulo %></h1>
        <p>Gerencie seus projetos de forma organizada e eficiente</p>
    </div>

    <!-- Formul√°rio para novo projeto -->
    <div class="form-container">
        <h2>‚ûï Criar Novo Projeto</h2>
        <form id="form-novo-projeto" class="projeto-form">
            <div class="form-group">
                <label for="nome">Nome do Projeto *</label>
                <input type="text" id="nome" name="nome" placeholder="Digite o nome do projeto" required minlength="3" maxlength="100" />
            </div>
            
            <div class="form-group">
                <label for="descricao">Descri√ß√£o (opcional)</label>
                <textarea id="descricao" name="descricao" placeholder="Descreva brevemente o projeto" rows="3" maxlength="500"></textarea>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <span>üöÄ</span> Criar Projeto
                </button>
                <button type="reset" class="btn btn-secondary">
                    <span>üîÑ</span> Limpar
                </button>
            </div>
        </form>
    </div>

    <!-- Lista de projetos -->
    <div class="projetos-container">
        <div class="projetos-header">
            <h2>üìã Lista de Projetos</h2>
            <div class="projetos-stats">
                <span id="total-projetos">0 projetos</span>
            </div>
        </div>
        
        <div id="loading" class="loading" style="display: none;">
            üîÑ Carregando projetos...
        </div>
        
        <div id="error-message" class="error-message" style="display: none;"></div>
        
        <ul id="lista-projetos" class="projetos-list"></ul>
    </div>
</section>

<style>
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.header-section {
    text-align: center;
    margin-bottom: 2rem;
}

.header-section h1 {
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.header-section p {
    color: #7f8c8d;
    font-size: 1.1rem;
}

.form-container {
    background: #f8f9fa;
    padding: 2rem;
    border-radius: 10px;
    margin-bottom: 2rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.form-container h2 {
    color: #2c3e50;
    margin-bottom: 1.5rem;
}

.projeto-form .form-group {
    margin-bottom: 1.5rem;
}

.projeto-form label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #34495e;
}

.projeto-form input,
.projeto-form textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e1e8ed;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
}

.projeto-form input:focus,
.projeto-form textarea:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

.form-actions {
    display: flex;
    gap: 1rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: #3498db;
    color: white;
}

.btn-primary:hover {
    background: #2980b9;
    transform: translateY(-2px);
}

.btn-secondary {
    background: #95a5a6;
    color: white;
}

.btn-secondary:hover {
    background: #7f8c8d;
}

.projetos-container {
    background: white;
    padding: 2rem;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.projetos-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #ecf0f1;
}

.projetos-header h2 {
    color: #2c3e50;
    margin: 0;
}

.projetos-stats {
    color: #7f8c8d;
    font-weight: 600;
}

.loading {
    text-align: center;
    padding: 2rem;
    color: #3498db;
    font-size: 1.1rem;
}

.error-message {
    background: #e74c3c;
    color: white;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    text-align: center;
}

.projetos-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.projeto-item {
    background: #f8f9fa;
    padding: 1.5rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    border-left: 4px solid #3498db;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.projeto-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.projeto-nome {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.projeto-descricao {
    color: #7f8c8d;
    margin-bottom: 1rem;
}

.projeto-actions {
    display: flex;
    gap: 0.5rem;
}

.btn-small {
    padding: 0.4rem 0.8rem;
    font-size: 0.9rem;
}

.btn-edit {
    background: #f39c12;
    color: white;
}

.btn-edit:hover {
    background: #e67e22;
}

.btn-delete {
    background: #e74c3c;
    color: white;
}

.btn-delete:hover {
    background: #c0392b;
}

.empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: #7f8c8d;
}

.empty-state h3 {
    margin-bottom: 1rem;
    color: #95a5a6;
}

@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .projetos-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .projeto-actions {
        flex-direction: column;
    }
}
</style>

<script>
// Estado da aplica√ß√£o
let projetos = [];

// Elementos DOM
const form = document.getElementById('form-novo-projeto');
const loading = document.getElementById('loading');
const errorMessage = document.getElementById('error-message');
const listaProjetos = document.getElementById('lista-projetos');
const totalProjetos = document.getElementById('total-projetos');

/**
 * Exibe mensagem de erro
 */
function mostrarErro(mensagem) {
    errorMessage.textContent = mensagem;
    errorMessage.style.display = 'block';
    setTimeout(() => {
        errorMessage.style.display = 'none';
    }, 5000);
}

/**
 * Exibe/oculta loading
 */
function mostrarLoading(show = true) {
    loading.style.display = show ? 'block' : 'none';
}

/**
 * Atualiza contador de projetos
 */
function atualizarStats() {
    const total = projetos.length;
    totalProjetos.textContent = total === 0 ? 'Nenhum projeto' : 
                                total === 1 ? '1 projeto' : 
                                `${total} projetos`;
}

/**
 * Carrega projetos da API
 */
async function carregarProjetos() {
    try {
        mostrarLoading(true);
        
        const response = await fetch('/api/projetos');
        const result = await response.json();
        
        if (!response.ok) {
            throw new Error(result.error || 'Erro ao carregar projetos');
        }
        
        projetos = result.data || result;
        renderizarProjetos();
        atualizarStats();
        
    } catch (error) {
        console.error('Erro ao carregar projetos:', error);
        mostrarErro('Erro ao carregar projetos: ' + error.message);
    } finally {
        mostrarLoading(false);
    }
}

/**
 * Renderiza lista de projetos
 */
function renderizarProjetos() {
    if (projetos.length === 0) {
        listaProjetos.innerHTML = `
            <div class="empty-state">
                <h3>üì≠ Nenhum projeto encontrado</h3>
                <p>Crie seu primeiro projeto usando o formul√°rio acima!</p>
            </div>
        `;
        return;
    }
    
    listaProjetos.innerHTML = projetos.map(projeto => `
        <li class="projeto-item" data-id="${projeto._id}">
            <div class="projeto-nome">${projeto.nome}</div>
            ${projeto.descricao ? `<div class="projeto-descricao">${projeto.descricao}</div>` : ''}
            <div class="projeto-actions">
                <button class="btn btn-edit btn-small" onclick="editarProjeto('${projeto._id}')">
                    ‚úèÔ∏è Editar
                </button>
                <button class="btn btn-delete btn-small" onclick="deletarProjeto('${projeto._id}')">
                    üóëÔ∏è Deletar
                </button>
            </div>
        </li>
    `).join('');
}

/**
 * Criar novo projeto
 */
async function criarProjeto(dados) {
    try {
        const response = await fetch('/api/projetos', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dados)
        });
        
        const result = await response.json();
        
        if (!response.ok) {
            throw new Error(result.error || 'Erro ao criar projeto');
        }
        
        form.reset();
        carregarProjetos();
        
        // Feedback visual
        const submitBtn = form.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '‚úÖ Projeto Criado!';
        submitBtn.disabled = true;
        
        setTimeout(() => {
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }, 2000);
        
    } catch (error) {
        console.error('Erro ao criar projeto:', error);
        mostrarErro('Erro ao criar projeto: ' + error.message);
    }
}

/**
 * Deletar projeto
 */
async function deletarProjeto(id) {
    if (!confirm('Tem certeza que deseja deletar este projeto?')) {
        return;
    }
    
    try {
        const response = await fetch(`/api/projetos/${id}`, {
            method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (!response.ok) {
            throw new Error(result.error || 'Erro ao deletar projeto');
        }
        
        carregarProjetos();
        
    } catch (error) {
        console.error('Erro ao deletar projeto:', error);
        mostrarErro('Erro ao deletar projeto: ' + error.message);
    }
}

/**
 * Editar projeto (implementa√ß√£o b√°sica)
 */
function editarProjeto(id) {
    const projeto = projetos.find(p => p._id === id);
    if (!projeto) return;
    
    const novoNome = prompt('Novo nome do projeto:', projeto.nome);
    if (!novoNome || novoNome.trim() === projeto.nome) return;
    
    const novaDescricao = prompt('Nova descri√ß√£o:', projeto.descricao || '');
    
    atualizarProjeto(id, {
        nome: novoNome.trim(),
        descricao: novaDescricao ? novaDescricao.trim() : ''
    });
}

/**
 * Atualizar projeto
 */
async function atualizarProjeto(id, dados) {
    try {
        const response = await fetch(`/api/projetos/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dados)
        });
        
        const result = await response.json();
        
        if (!response.ok) {
            throw new Error(result.error || 'Erro ao atualizar projeto');
        }
        
        carregarProjetos();
        
    } catch (error) {
        console.error('Erro ao atualizar projeto:', error);
        mostrarErro('Erro ao atualizar projeto: ' + error.message);
    }
}

// Event Listeners
form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(form);
    const dados = {
        nome: formData.get('nome').trim(),
        descricao: formData.get('descricao').trim()
    };
    
    if (!dados.nome) {
        mostrarErro('Nome do projeto √© obrigat√≥rio');
        return;
    }
    
    await criarProjeto(dados);
});

// Inicializa√ß√£o
document.addEventListener('DOMContentLoaded', () => {
    carregarProjetos();
});
</script>